<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zaad Royal V23 (Ultimate Edition)</title>
    <style>
        /* --- 1. FONTS & THEME --- */
        @font-face { font-family: 'Faruma'; src: url('https://academyzaad.com/fonts/af_faruma.ttf') format('truetype'); }
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Amiri:wght@400;700&display=swap');

        :root { 
            --primary: #FFD700;       /* Royal Gold */
            --primary-dim: #B8860B;   /* Darker Gold */
            --bg-dark: #001a33;       /* Deep Royal Blue */
            --glass: rgba(0, 30, 60, 0.95); /* Blue-tinted Glass */
            --text-main: #fff;
            --error: #ff4444;
        }
        
        /* DISABLE SELECTION & OUTLINES FOR SECURITY */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }

        body { 
            background: radial-gradient(circle at center, #003366 0%, #000814 100%); 
            color: var(--primary); 
            margin: 0; height: 100vh; overflow: hidden; 
            transition: all 0.3s ease;
        }

        /* Language Specific Fonts */
        body[lang="dv"] { font-family: 'Faruma', sans-serif; }
        body[lang="ar"] { font-family: 'Amiri', serif; font-size: 1.1em; }
        body[lang="en"] { font-family: 'Roboto', sans-serif; }

        /* --- 2. LAYOUT --- */
        .view { display: none; height: 100%; width: 100%; flex-direction: column; position: absolute; top:0; left:0; background:#000; z-index: 10; } 
        .active { display: flex !important; z-index: 100; background: transparent; }
        .center-box { justify-content: center; align-items: center; }

        /* --- 3. UI COMPONENTS --- */
        .card { 
            background: var(--glass); border: 2px solid var(--primary); 
            padding: 40px; border-radius: 20px; text-align: center; 
            box-shadow: 0 0 60px rgba(0,0,0,0.8); width: 90%; max-width: 450px; 
            position: relative; overflow: hidden;
        }

        input, select { 
            width: 100%; padding: 12px; background: rgba(0,0,0,0.4); 
            border: 1px solid #444; border-bottom: 2px solid var(--primary); 
            color: #fff; text-align: center; margin-top: 10px; border-radius: 5px; 
            font-size: 16px; font-family: inherit;
        }

        /* Force Password Input to be LTR (Left-to-Right) always */
        input[type="password"] {
            direction: ltr !important;
            font-family: 'Roboto', sans-serif !important;
            letter-spacing: 2px;
        }

        .btn { 
            background: linear-gradient(45deg, var(--primary-dim), var(--primary)); border: none; 
            padding: 12px; width: 100%; font-weight: bold; cursor: pointer; 
            border-radius: 8px; margin-top: 15px; color: #000; font-size: 16px; 
            transition: 0.3s; font-family: inherit; text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .btn:hover { transform: scale(1.02); filter: brightness(1.2); }
        .btn:active { transform: scale(0.95); }
        
        .btn-blue { background: linear-gradient(45deg, #004080, #0059b3); color: #fff; border: 1px solid var(--primary); }
        .btn-red { background: linear-gradient(45deg, #800000, #b30000); color: #fff; }
        .btn-green { background: linear-gradient(45deg, #006600, #009900); color: #fff; }

        /* LANG SWITCHER */
        .lang-switch { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .lang-btn { background: transparent; border: 1px solid var(--primary); color: var(--primary); padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; }
        .lang-btn.active-lang { background: var(--primary); color: #000; font-weight: bold; }

        /* --- 4. GRID SYSTEM --- */
        .control-grid { 
            display: grid; grid-template-columns: 280px 1fr 300px; 
            gap: 20px; height: 100%; padding: 20px; overflow: hidden; 
        }
        .panel { 
            background: rgba(0, 20, 40, 0.7); border: 1px solid #333; 
            padding: 20px; border-radius: 15px; overflow-y: auto; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        @media (max-width: 1000px) {
            .control-grid { display: block; overflow-y: auto; }
            .panel { margin-bottom: 20px; max-height: 500px; }
            .dash-layout { flex-direction: column-reverse; } 
            .sidebar { width: 100%; height: 300px; border-left: none; border-top: 2px solid var(--primary); }
        }

        /* --- 5. LISTS & PREVIEWS --- */
        .student-item { 
            padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); 
            cursor: pointer; display: flex; justify-content: space-between; transition: 0.2s; 
        }
        .student-item:hover { background: rgba(212, 175, 55, 0.2); }
        .student-item.selected { background: var(--primary); color: #000; font-weight: bold; border-radius: 5px; }

        .question-preview { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-top: 15px; }
        .q-thumb { width: 80px; height: 100px; border: 1px solid var(--primary); object-fit: cover; background: #000; }
        
        /* --- 6. MODALS & TOAST --- */
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:2000; justify-content:center; align-items:center; }
        .modal-content { background: #001a33; border: 2px solid var(--primary); padding: 30px; width: 600px; max-width: 90%; border-radius: 15px; max-height: 90vh; overflow-y: auto; text-align: center; }

        .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #003366; border: 1px solid var(--primary); color: #fff; padding: 12px 30px; border-radius: 30px; display: none; z-index: 3000; font-family: sans-serif; pointer-events: none; box-shadow: 0 5px 20px rgba(0,0,0,0.5); }
        
        /* --- 7. JUDGE LAYOUT --- */
        .dash-layout { display: flex; height: 100%; width: 100%; }
        .sidebar { width: 320px; background: rgba(0,0,0,0.5); border-left: 2px solid var(--primary); padding: 20px; display: flex; flex-direction: column; }
        .main { flex: 1; padding: 30px; overflow-y: auto; }

        /* SECURITY OVERLAY */
        #security-alert {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #b30000; z-index: 99999; color: white; justify-content: center; align-items: center;
            font-size: 30px; font-weight: bold; text-align: center;
            font-family: sans-serif;
        }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="toast" class="toast">Notification</div>
    <div id="security-alert">‚ö†Ô∏è SECURITY ALERT: ILLEGAL ACTION</div>

    <div id="v-license" class="view active center-box" style="z-index: 999;">
        <div class="card">
            <h1 style="font-size:40px;">üîê</h1>
            <h2 style="color:var(--primary);">ACTIVATION REQUIRED</h2>
            <p style="color:#aaa; font-size:14px;">This software is protected.</p>
            
            <input type="text" id="licenseKeyInput" placeholder="Paste License Key Here..." style="font-family:monospace; font-size:12px; direction: ltr;">
            <button onclick="verifyLicense()" class="btn btn-green">ACTIVATE</button>
            <p id="licMsg" style="color:var(--error); margin-top:10px; font-size:12px;"></p>
        </div>
    </div>

    <div id="v-login" class="view center-box">
        <div class="card">
            <div class="lang-switch">
                <button onclick="setLanguage('dv')" class="lang-btn" id="btn_lang_dv">ﬁãﬁ®ﬁàﬁ¨ﬁÄﬁ®</button>
                <button onclick="setLanguage('en')" class="lang-btn" id="btn_lang_en">English</button>
                <button onclick="setLanguage('ar')" class="lang-btn" id="btn_lang_ar">ÿπÿ±ÿ®Ÿä</button>
            </div>

            <img src="https://academyzaad.com/photos/logo.png" width="120" style="margin-bottom:15px;" onerror="this.style.display='none'">
            <h2 id="lbl_app_title" style="margin:5px 0; color:var(--primary); font-size: 28px;">ZAAD SYSTEM V23</h2>
            <p id="lbl_app_sub" style="font-size:14px; color:#aaa; margin-bottom:20px;">Royal Blue Edition</p>
            
            <div id="licenseInfo" style="font-size:10px; color:#4CAF50; border:1px solid #4CAF50; padding:5px; margin-bottom:15px; border-radius:4px;">License Active</div>

            <label id="lbl_role" style="font-size:12px; display:block; text-align:right; color:#aaa;">Login As</label>
            <select id="role">
                <option value="admin">Admin</option>
                <option value="judge">Judge</option>
            </select>
            
            <label id="lbl_pass" style="font-size:12px; display:block; text-align:right; color:#aaa; margin-top:15px;">Password</label>
            
            <input type="password" id="pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocapitalize="off">
            
            <button id="btn_login" onclick="attemptLogin()" class="btn">LOGIN</button>
        </div>
    </div>

    <div id="v-admin" class="view">
        <div style="background:rgba(0,0,0,0.8); padding:15px 20px; border-bottom:1px solid var(--primary); display:flex; justify-content:space-between; align-items:center;">
            <span id="lbl_control_room" style="font-weight:bold; font-size: 20px;">üéõÔ∏è CONTROL ROOM</span>
            <div style="display:flex; gap:10px; align-items:center;">
                 <div class="lang-switch" style="margin:0;">
                    <button onclick="setLanguage('dv')" class="lang-btn">DV</button>
                    <button onclick="setLanguage('en')" class="lang-btn">EN</button>
                    <button onclick="setLanguage('ar')" class="lang-btn">AR</button>
                </div>
                <button id="btn_exit" onclick="logout()" class="btn btn-red" style="width:auto; margin:0; padding:5px 20px; font-size:14px;">EXIT</button>
            </div>
        </div>

        <div class="control-grid">
            <div class="panel">
                <h3 id="lbl_participants">üìã PARTICIPANTS</h3>
                <button id="btn_data_mgr" onclick="openDataManager()" class="btn btn-green" style="font-size:14px; margin-bottom:15px;">üìÇ DATA MANAGER</button>
                <input id="inp_search" type="text" placeholder="Search..." onkeyup="renderList(this.value)">
                <div id="stuList" style="margin-top:15px;"></div>
            </div>

            <div class="panel" style="text-align:center;">
                <h3 id="lbl_screens">üì° SCREENS</h3>
                <div style="display:flex; gap:10px; justify-content:center;">
                    <button id="btn_scr_stu" onclick="openExternalWin('STUDENT')" class="btn" style="width:48%; background:#fff; color:#000;">Student</button>
                    <button id="btn_scr_aud" onclick="openExternalWin('AUDIENCE')" class="btn" style="width:48%; background:#fff; color:#000;">Audience</button>
                </div>

                <div style="margin-top:25px; border:1px solid #444; padding:15px; border-radius:10px; background:rgba(0,0,0,0.3);">
                    <h4 id="lbl_design" style="margin:0 0 10px 0; color:#aaa;">üé® DESIGN STUDIO</h4>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                        <button id="btn_frame" onclick="changeStyle('border')" class="btn" style="background:#003366; color:#fff; border:1px solid var(--primary); margin:0;">üî≤ Frame</button>
                        <button id="btn_bg" onclick="changeStyle('bg')" class="btn" style="background:#003366; color:#fff; border:1px solid var(--primary); margin:0;">üñºÔ∏è BG</button>
                    </div>
                </div>

                <div style="margin-top:25px; padding: 15px; border: 1px dashed var(--primary); border-radius: 10px;">
                    <h3 id="activeName" style="color:var(--primary); margin:0;">Select Student</h3>
                    <p id="activeInfo" style="color:#aaa; font-size:12px; margin:5px 0;">Waiting...</p>
                </div>

                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:15px;">
                    <button id="btn_profile" onclick="sendToScreen('PROFILE')" class="btn">üë§ Profile</button>
                    <button id="btn_score" onclick="sendToScreen('SCORE')" class="btn btn-blue">üèÜ Score</button>
                </div>
                <button id="btn_next_stu" onclick="resetSystem()" class="btn btn-red">üîÑ NEXT STUDENT</button>
            </div>

            <div class="panel">
                <h3 id="lbl_lottery">üé≤ LOTTERY</h3>
                <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px;">
                    <label id="lbl_limit" style="margin:0;">Pick Limit:</label>
                    <input type="number" id="pickLimit" value="2" style="width:70px; margin:0; direction: ltr;">
                </div>
                <button id="btn_start_draw" onclick="startLottery()" class="btn btn-blue" style="font-size: 18px; padding: 20px;">START DRAW</button>
                
                <h4 style="margin-top:20px; border-bottom:1px solid #444;">Selected:</h4>
                <div id="liveQuestions" class="question-preview"></div>
                
                <hr style="border-color:#333; margin:30px 0;">
                <button id="btn_reset" onclick="fullReset()" class="btn btn-red" style="font-size:12px;">‚ö†Ô∏è Factory Reset</button>
                <button onclick="removeLicense()" class="btn btn-red" style="font-size:10px; margin-top:5px; width:auto; padding:5px;">üóëÔ∏è Lock System</button>
            </div>
        </div>
    </div>

    <div id="dataModal" class="modal">
        <div class="modal-content">
            <h2 style="color:var(--primary); margin-top:0;">üìÇ DATA SETTINGS</h2>
            
            <div style="background:rgba(0,0,0,0.3); padding:20px; border-radius:10px; margin-bottom:20px;">
                <h4>Import from Google Sheets</h4>
                <input type="text" id="scriptUrl" placeholder="Paste Google Script URL here..." style="direction:ltr;">
                <button onclick="importFromSheet()" class="btn btn-blue">üì• Import Now</button>
            </div>

            <div style="background:rgba(0,0,0,0.3); padding:20px; border-radius:10px; margin-bottom:20px;">
                <h4>Manual Add</h4>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <input type="text" id="newReg" placeholder="Reg No">
                    <input type="text" id="newName" placeholder="Name">
                </div>
                <button onclick="addManualStudent()" class="btn btn-green">‚ûï Add Student</button>
            </div>

            <div style="background:rgba(0,0,0,0.3); padding:20px; border-radius:10px;">
                <h4>Total Questions (in q/ folder)</h4>
                <input type="number" id="totalQInput" value="20" style="width:100px; direction:ltr;">
                <button onclick="saveQSettings()" class="btn">üíæ Save Limit</button>
            </div>

            <button onclick="document.getElementById('dataModal').style.display='none'" class="btn btn-red">CLOSE</button>
        </div>
    </div>

    <div id="v-judge" class="view">
        <div class="dash-layout">
            <div class="main">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3>JUDGE PANEL</h3>
                    <button onclick="logout()" class="btn btn-red" style="width:auto; margin:0; padding:5px 20px;">LOGOUT</button>
                </div>

                <div id="jWait" style="text-align:center; margin-top:100px; color:#aaa;">
                    <h1>Waiting for Selection...</h1>
                </div>

                <div id="judgeScoreArea" style="display:none; margin-top:20px;">
                    <div style="display:flex; align-items:center; gap:20px; background:rgba(0,0,0,0.4); padding:20px; border-radius:15px; border:1px solid var(--primary);">
                        <img id="jPhoto" src="" style="width:80px; height:80px; border-radius:50%; object-fit:cover; border: 2px solid var(--primary);">
                        <div>
                            <h2 id="jName" style="margin:0;">Name</h2>
                            <p id="jInfo" style="color:#aaa; margin:5px 0;">Reg</p>
                        </div>
                    </div>

                    <div style="margin-top:30px;">
                        <h4 style="color:var(--primary);">SELECTED QUESTIONS:</h4>
                        <div id="judgeQView" class="question-preview"></div>
                    </div>

                    <div id="scoringGrid" style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:30px;">
                        </div>
                    
                    <button onclick="submitScore()" class="btn btn-blue" style="margin-top: 30px;">SUBMIT SCORE</button>
                </div>
            </div>
            
            <div class="sidebar">
                <h4>STUDENT LIST</h4>
                <div id="judgeStuList" style="overflow-y:auto; flex:1;"></div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // üåç LANGUAGE SYSTEM
        // ==========================================
        const translations = {
            dv: {
                lbl_app_title: "ﬁíﬁßﬁãﬁ™ ﬁêﬁ®ﬁêﬁ∞ﬁìﬁ¶ﬁâﬁ∞ ﬁàﬁ©23",
                lbl_app_sub: "ﬁÉﬁØﬁîﬁ¶ﬁçﬁ∞ ﬁÑﬁ∞ﬁçﬁ´ ﬁáﬁ¨ﬁëﬁ®ﬁùﬁ¶ﬁÇﬁ∞",
                lbl_role: "ﬁâﬁ¶ﬁ§ﬁßﬁâﬁ∞",
                lbl_pass: "ﬁïﬁßﬁêﬁ∞ﬁàﬁØﬁëﬁ∞",
                btn_login: "ﬁàﬁ¶ﬁãﬁ≠ (ﬁçﬁÆﬁéﬁ®ﬁÇﬁ∞)",
                lbl_control_room: "üéõÔ∏è ﬁÜﬁÆﬁÇﬁ∞ﬁìﬁ∞ﬁÉﬁØﬁçﬁ∞ ﬁÉﬁ´ﬁâﬁ∞",
                btn_exit: "ﬁÇﬁ®ﬁÜﬁ™ﬁâﬁ≠",
                lbl_participants: "üìã ﬁÑﬁ¶ﬁáﬁ®ﬁàﬁ¨ﬁÉﬁ®ﬁÇﬁ∞",
                btn_data_mgr: "üìÇ ﬁëﬁ≠ﬁìﬁß ﬁâﬁ¨ﬁÇﬁ≠ﬁñﬁ¶ﬁÉ",
                inp_search: "ﬁÄﬁØﬁáﬁ∞ﬁãﬁ¶ﬁàﬁß...",
                lbl_screens: "üì° ﬁêﬁ∞ﬁÜﬁ∞ﬁÉﬁ©ﬁÇﬁ∞ﬁåﬁ¶ﬁáﬁ∞",
                btn_scr_stu: "ﬁãﬁ¶ﬁÉﬁ®ﬁàﬁ¶ﬁÉﬁ™",
                btn_scr_aud: "ﬁÑﬁ¨ﬁçﬁ™ﬁÇﬁ∞ﬁåﬁ¨ﬁÉﬁ®ﬁÇﬁ∞",
                lbl_design: "üé® ﬁëﬁ®ﬁíﬁ¶ﬁáﬁ®ﬁÇﬁ∞ ﬁêﬁ∞ﬁìﬁ´ﬁëﬁ®ﬁáﬁØ",
                btn_frame: "üî≤ ﬁäﬁ∞ﬁÉﬁ≠ﬁâﬁ∞",
                btn_bg: "üñºÔ∏è ﬁÑﬁ¨ﬁÜﬁ∞ﬁéﬁ∞ﬁÉﬁ¶ﬁáﬁ™ﬁÇﬁ∞ﬁëﬁ∞",
                activeName: "ﬁãﬁ¶ﬁÉﬁ®ﬁàﬁ¶ﬁÉﬁ¨ﬁáﬁ∞ ﬁÇﬁ¶ﬁéﬁß",
                btn_profile: "üë§ ﬁïﬁ∞ﬁÉﬁÆﬁäﬁ¶ﬁáﬁ®ﬁçﬁ∞",
                btn_score: "üèÜ ﬁÇﬁ¶ﬁåﬁ©ﬁñﬁß",
                btn_next_stu: "üîÑ ﬁãﬁ¨ﬁÇﬁ∞ ﬁáﬁ®ﬁÇﬁ∞ ﬁÜﬁ™ﬁáﬁ∞ﬁñﬁß",
                lbl_lottery: "üé≤ ﬁéﬁ™ﬁÉﬁ™ﬁáﬁ¶ﬁåﬁ™ (ﬁçﬁÆﬁìﬁ¶ﬁÉﬁ©)",
                lbl_limit: "ﬁêﬁ™ﬁàﬁßﬁçﬁ™ ﬁáﬁ¶ﬁãﬁ¶ﬁãﬁ™:",
                btn_start_draw: "ﬁéﬁ™ﬁÉﬁ™ﬁáﬁ¶ﬁåﬁ™ ﬁÇﬁ¶ﬁéﬁß",
                btn_reset: "‚ö†Ô∏è ﬁäﬁ¨ﬁÜﬁ∞ﬁìﬁ¶ﬁÉﬁ© ﬁÉﬁ®ﬁêﬁ¨ﬁìﬁ∞"
            },
            en: {
                lbl_app_title: "ZAAD SYSTEM V23",
                lbl_app_sub: "Royal Blue Edition",
                lbl_role: "Login As",
                lbl_pass: "Password",
                btn_login: "LOGIN",
                lbl_control_room: "üéõÔ∏è CONTROL ROOM",
                btn_exit: "EXIT",
                lbl_participants: "üìã PARTICIPANTS",
                btn_data_mgr: "üìÇ DATA MANAGER",
                inp_search: "Search...",
                lbl_screens: "üì° SCREENS",
                btn_scr_stu: "Student",
                btn_scr_aud: "Audience",
                lbl_design: "üé® DESIGN STUDIO",
                btn_frame: "üî≤ Frame",
                btn_bg: "üñºÔ∏è BG",
                activeName: "Select Student",
                btn_profile: "üë§ Profile",
                btn_score: "üèÜ Score",
                btn_next_stu: "üîÑ NEXT STUDENT",
                lbl_lottery: "üé≤ LOTTERY",
                lbl_limit: "Pick Limit:",
                btn_start_draw: "START DRAW",
                btn_reset: "‚ö†Ô∏è Factory Reset"
            },
            ar: {
                lbl_app_title: "ŸÜÿ∏ÿßŸÖ ÿ≤ÿßÿØ ÿßŸÑÿ•ÿµÿØÿßÿ± 23",
                lbl_app_sub: "ÿßŸÑÿ•ÿµÿØÿßÿ± ÿßŸÑÿ£ÿ≤ÿ±ŸÇ ÿßŸÑŸÖŸÑŸÉŸä",
                lbl_role: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÉŸÄ",
                lbl_pass: "ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±",
                btn_login: "ÿØÿÆŸàŸÑ",
                lbl_control_room: "üéõÔ∏è ÿ∫ÿ±ŸÅÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ",
                btn_exit: "ÿÆÿ±Ÿàÿ¨",
                lbl_participants: "üìã ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉŸàŸÜ",
                btn_data_mgr: "üìÇ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™",
                inp_search: "ÿ®ÿ≠ÿ´...",
                lbl_screens: "üì° ÿßŸÑÿ¥ÿßÿ¥ÿßÿ™",
                btn_scr_stu: "ÿßŸÑÿ∑ÿßŸÑÿ®",
                btn_scr_aud: "ÿßŸÑÿ¨ŸÖŸáŸàÿ±",
                lbl_design: "üé® ÿßÿ≥ÿ™ŸàÿØŸäŸà ÿßŸÑÿ™ÿµŸÖŸäŸÖ",
                btn_frame: "üî≤ ÿßŸÑÿ•ÿ∑ÿßÿ±",
                btn_bg: "üñºÔ∏è ÿßŸÑÿÆŸÑŸÅŸäÿ©",
                activeName: "ÿßÿÆÿ™ÿ± ÿ∑ÿßŸÑÿ®ÿßŸã",
                btn_profile: "üë§ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä",
                btn_score: "üèÜ ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©",
                btn_next_stu: "üîÑ ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ™ÿßŸÑŸä",
                lbl_lottery: "üé≤ ÿßŸÑŸÇÿ±ÿπÿ©",
                lbl_limit: "ÿπÿØÿØ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©:",
                btn_start_draw: "ÿ®ÿØÿ° ÿßŸÑÿ≥ÿ≠ÿ®",
                btn_reset: "‚ö†Ô∏è ÿ•ÿπÿßÿØÿ© ÿ∂ÿ®ÿ∑ ÿßŸÑŸÖÿµŸÜÿπ"
            }
        };

        let currentLang = 'dv'; // Default

        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            
            // 1. Update Direction & HTML Lang
            const html = document.documentElement;
            html.lang = lang;
            html.dir = (lang === 'en') ? 'ltr' : 'rtl';
            document.body.lang = lang; 

            // 2. Update UI Text
            for (const [key, value] of Object.entries(t)) {
                const el = document.getElementById(key);
                if (el) {
                    if (el.tagName === 'INPUT') el.placeholder = value;
                    else el.innerText = value;
                }
            }

            // 3. Update Buttons State
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active-lang'));
            document.getElementById(`btn_lang_${lang}`).classList.add('active-lang');
        }

        // ==========================================
        // üõ°Ô∏è SECURITY & LICENSE SYSTEM
        // ==========================================
        
        // Disable Context Menu
        document.addEventListener('contextmenu', event => event.preventDefault());

        // Block Restricted Keys
        document.addEventListener('keydown', function(e) {
            if (e.keyCode === 123 || // F12
               (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) || // Ctrl+Shift+I/J
               (e.ctrlKey && e.keyCode === 85) || // Ctrl+U
               (e.ctrlKey && e.keyCode === 83) || // Ctrl+S
               (e.ctrlKey && e.keyCode === 80)) { // Ctrl+P
                e.preventDefault();
                showSecurityAlert();
                return false;
            }
        });

        // Block Image Dragging
        document.addEventListener("dragstart", function(e) {
             if (e.target.nodeName.toUpperCase() == "IMG") { return false; }
        });

        function showSecurityAlert() {
            const al = document.getElementById('security-alert');
            al.style.display = 'flex';
            setTimeout(() => al.style.display = 'none', 1000);
        }

        // License Check on Load
        function initLicenseCheck() {
            const savedKey = localStorage.getItem('zaad_license_key');
            if(savedKey) {
                if(validateKeyLogic(savedKey)) {
                    document.getElementById('v-license').classList.remove('active');
                    document.getElementById('v-login').classList.add('active');
                }
            }
        }

        // Validate License Button
        function verifyLicense() {
            const key = document.getElementById('licenseKeyInput').value.trim();
            const msg = document.getElementById('licMsg');
            if(validateKeyLogic(key)) {
                localStorage.setItem('zaad_license_key', key);
                msg.style.color = "#4CAF50";
                msg.innerText = "License Verified! Loading...";
                setTimeout(() => {
                    document.getElementById('v-license').classList.remove('active');
                    switchScreen('v-login');
                }, 1000);
            } else {
                msg.style.color = "#ff4444";
                msg.innerText = "‚ùå Invalid or Expired Key";
            }
        }

        // Logic to validate Base64 Key
        function validateKeyLogic(key) {
            try {
                const decoded = atob(key); 
                const parts = decoded.split('_');
                // Key Structure: ROYAL_EXP_YYYY-MM-DD_CUST_Name
                if(parts[0] !== 'ROYAL' || parts[1] !== 'EXP') return false;
                
                const expDateStr = parts[2]; 
                const expDate = new Date(expDateStr);
                const today = new Date();
                today.setHours(0,0,0,0);
                
                if(today > expDate) return false; 
                
                document.getElementById('licenseInfo').innerText = `Licensed to: ${parts[4]} (Exp: ${expDateStr})`;
                return true;
            } catch(e) { return false; }
        }

        function removeLicense() {
            if(confirm("Lock System? You will need Key to enter again.")) {
                localStorage.removeItem('zaad_license_key');
                location.reload();
            }
        }

        // ==========================================
        // üèóÔ∏è MAIN APP LOGIC
        // ==========================================

        const PHOTO_PATH = "q/"; 
        let TOTAL_Q = 20;
        let students = [{ reg:"001", name:"Ahmed Ali", cat:"Quran", img:"https://via.placeholder.com/150" }];
        let activeStudent = null;
        let usedNumbers = JSON.parse(localStorage.getItem('zaad_used') || "[]");
        let currentPicks = [];
        let stuWin = null, audWin = null;

        // Styles
        const BORDERS = ["10px double #FFD700", "8px solid #FFD700", "15px ridge #c0c0c0", "12px groove #B8860B", "10px inset #fff", "5px dashed #FFD700", "20px solid transparent"];
        const BACKGROUNDS = ["radial-gradient(circle, #003366, #000814)", "url('https://img.freepik.com/free-vector/islamic-gradient-background-design_23-2148906373.jpg')", "#000000", "linear-gradient(135deg, #1a2980, #26d0ce)"];
        let currentBorder = BORDERS[0];
        let currentBg = BACKGROUNDS[0];

        // On Load
        window.onload = function() {
            if(localStorage.getItem('zaad_students')) students = JSON.parse(localStorage.getItem('zaad_students'));
            if(localStorage.getItem('zaad_total_q')) TOTAL_Q = parseInt(localStorage.getItem('zaad_total_q'));
            setLanguage('dv'); // Default Language
            initLicenseCheck(); 
        };

        // Login Logic
        function attemptLogin() {
            const pass = document.getElementById('pass').value.trim().toLowerCase();
            // Single password for all languages
            if (pass === 'admin123') { switchScreen('v-admin'); renderList(); }
            else if (pass === 'judge123') { switchScreen('v-judge'); renderList(); }
            else showToast("‚ùå Incorrect Password");
        }

        function switchScreen(id) {
            document.querySelectorAll('.view').forEach(v => { v.style.display='none'; v.classList.remove('active'); });
            const t = document.getElementById(id); t.style.display='flex'; setTimeout(()=>t.classList.add('active'),10);
        }
        function logout() { document.getElementById('pass').value=""; switchScreen('v-login'); }
        function showToast(msg) { const t=document.getElementById('toast'); t.innerText=msg; t.style.display="block"; setTimeout(()=>t.style.display="none",3000); }

        // Data & Settings
        function openDataManager() { document.getElementById('totalQInput').value = TOTAL_Q; document.getElementById('dataModal').style.display = 'flex'; }
        function saveQSettings() {
            const val = document.getElementById('totalQInput').value;
            if(val) { TOTAL_Q = parseInt(val); localStorage.setItem('zaad_total_q', TOTAL_Q); showToast("‚úÖ Limit Saved"); }
        }
        function addManualStudent() {
            const reg = document.getElementById('newReg').value;
            const name = document.getElementById('newName').value;
            if(reg && name) { 
                students.push({reg, name, cat:"Manual", img:"https://via.placeholder.com/150"}); 
                localStorage.setItem('zaad_students', JSON.stringify(students));
                renderList(); showToast("‚úÖ Added"); 
            }
        }
        function importFromSheet() {
            const url = document.getElementById('scriptUrl').value;
            if(!url) return showToast("Enter URL");
            fetch(url + "?action=getStudents", { method: "POST" })
            .then(r => r.json()).then(d => {
                if(d.result==="success") {
                    students = d.students.map(s => ({reg: s.regNo, name: s.name, cat: s.category, img: s.photo||""}));
                    localStorage.setItem('zaad_students', JSON.stringify(students));
                    renderList(); showToast("‚úÖ Imported");
                }
            });
        }

        // List Rendering
        function renderList(filter="") {
            const html = students.filter(s => s.name.toLowerCase().includes(filter.toLowerCase()) || s.reg.includes(filter))
                .map(s => `<div class="student-item" onclick="selectStudent('${s.reg}')"><span><b>${s.reg}</b> ${s.name}</span></div>`).join('');
            document.getElementById('stuList').innerHTML = html;
            document.getElementById('judgeStuList').innerHTML = html;
        }

        function selectStudent(reg) {
            activeStudent = students.find(s => s.reg === reg);
            document.getElementById('activeName').innerText = activeStudent.name;
            document.getElementById('activeInfo').innerText = activeStudent.reg;
            
            document.getElementById('jWait').style.display='none';
            document.getElementById('judgeScoreArea').style.display='block';
            document.getElementById('jName').innerText = activeStudent.name;
            document.getElementById('jPhoto').src = activeStudent.img || "https://via.placeholder.com/150";
            document.getElementById('jInfo').innerText = activeStudent.reg;
            document.getElementById('scoringGrid').innerHTML = `
                <input type="number" placeholder="Tajweed (40)" style="direction:ltr;">
                <input type="number" placeholder="Fasaahath (30)" style="direction:ltr;">
                <input type="number" placeholder="Voice (20)" style="direction:ltr;">
                <input type="number" placeholder="Hifz (10)" style="direction:ltr;">`;
        }

        // Style Changer
        function changeStyle(type) {
            if(type === 'border') {
                const idx = BORDERS.indexOf(currentBorder);
                currentBorder = BORDERS[(idx + 1) % BORDERS.length];
            } else {
                const idx = BACKGROUNDS.indexOf(currentBg);
                currentBg = BACKGROUNDS[(idx + 1) % BACKGROUNDS.length];
            }
            syncStyles();
        }
        function syncStyles() {
            const js = `
                document.body.style.background = "${currentBg}"; 
                document.body.style.backgroundSize = "cover";
                document.querySelectorAll('.royal-frame').forEach(f => { f.style.border = "${currentBorder}"; });
            `;
            if(stuWin && !stuWin.closed) stuWin.eval(js);
            if(audWin && !audWin.closed) audWin.eval(js);
        }

        // Secondary Screens
        const SCREEN_CSS = `
            <style>
                @font-face { font-family: 'Faruma'; src: url('https://academyzaad.com/fonts/af_faruma.ttf') format('truetype'); }
                body { margin:0; background: radial-gradient(circle at center, #003366 0%, #000814 100%); background-size:cover; display:flex; justify-content:center; align-items:center; height:100vh; overflow:hidden; font-family:'Faruma'; color:#FFD700; transition: background 0.5s; user-select:none; }
                #fs-btn { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.8); border: 2px solid #FFD700; color: #fff; padding: 20px 40px; font-size: 24px; cursor: pointer; z-index: 9999; border-radius: 15px; animation: pulse 2s infinite; }
                @keyframes pulse { 0% { transform: translate(-50%, -50%) scale(1); } 50% { transform: translate(-50%, -50%) scale(1.1); } 100% { transform: translate(-50%, -50%) scale(1); } }
                .welcome-card { text-align:center; animation: fadeIn 2s; background: rgba(0,0,0,0.7); padding: 40px; border-radius: 20px; border: 2px solid #FFD700; }
                .welcome-card img { width: 150px; margin-bottom: 20px; }
                .welcome-card h1 { font-size: 60px; margin: 0; text-shadow: 2px 2px 10px #000; }
                .stage-center { display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; height: 100%; }
                .grid { display:flex; flex-wrap: wrap; justify-content: center; align-content: center; gap: 20px; max-width: 1200px; padding: 20px; }
                .box { width: 120px; height: 120px; background: rgba(0, 30, 60, 0.8); border: 2px solid #FFD700; display: flex; justify-content: center; align-items: center; font-size: 50px; color: #FFD700; cursor: pointer; border-radius: 15px; transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
                .box:hover { transform: scale(1.1); background: #FFD700; color: #000; }
                .box.picked { background: #FFD700; color: #000; transform: scale(1.1); box-shadow: 0 0 40px #FFD700; }
                .box.disabled { opacity: 0.1; pointer-events: none; }
                .q-container { display: flex; gap: 30px; justify-content: center; width: 100%; align-items: center; flex-wrap: wrap; }
                .royal-frame { border: 10px double #FFD700; padding: 10px; background: #000; box-shadow: 0 0 60px rgba(255, 215, 0, 0.4); border-radius: 10px; animation: zoomIn 0.8s; max-width: 45%; max-height: 85vh; }
                .royal-frame img { width: 100%; height: auto; display: block; max-height: 80vh; object-fit: contain; }
                .profile { text-align:center; background:rgba(0,0,0,0.8); padding:50px; border-radius:30px; border:4px solid #FFD700; width:80%; }
                @keyframes zoomIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
                @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
            </style>
        `;
        const FS_SCRIPT = `<script>function goFull() { document.documentElement.requestFullscreen(); document.getElementById('fs-btn').style.display = 'none'; } document.addEventListener('contextmenu', event => event.preventDefault());<\/script>`;

        function openExternalWin(type) {
            const w = 800, h = 600;
            const content = `
                <button id="fs-btn" onclick="goFull()">üî≤ GO FULL SCREEN</button>
                <div class="welcome-card">
                    <img src="https://academyzaad.com/photos/logo.png">
                    <h1>ACADEMY ZAAD</h1>
                    <p style="font-size:20px; color:#FFD700;">${type === 'STUDENT' ? 'Student Station' : 'Welcome Audience'}</p>
                </div>`;
            const win = window.open("", type, `width=${w},height=${h}`);
            win.document.write(`<html><head><title>${type}</title>${SCREEN_CSS}</head><body>${content}${FS_SCRIPT}</body></html>`);
            if(type=='STUDENT') stuWin = win; else audWin = win;
            setTimeout(syncStyles, 500);
        }

        // Lottery System
        function startLottery() {
            if(!stuWin || stuWin.closed) { showToast("‚ö†Ô∏è Open Student Screen"); return; }
            if(!activeStudent) { showToast("‚ö†Ô∏è Select Student"); return; }
            currentPicks = [];
            const limit = document.getElementById('pickLimit').value;
            let html = `<div class="stage-center"><h1 style="color:#fff; margin-bottom:30px; text-shadow:0 0 10px #000;">Select ${limit} Numbers</h1><div class="grid">`;
            for(let i=1; i<=TOTAL_Q; i++) {
                let cls = usedNumbers.includes(i) ? "box disabled" : "box";
                html += `<div id="b${i}" class="${cls}" onclick="window.opener.handlePick(${i})">${i}</div>`;
            }
            html += `</div></div>`;
            stuWin.document.body.innerHTML = html;
            syncStyles();
        }

        window.handlePick = function(num) {
            const limit = document.getElementById('pickLimit').value;
            if(currentPicks.includes(num)) return;
            stuWin.document.getElementById(`b${num}`).className = "box picked";
            stuWin.document.getElementById(`b${num}`).innerText = "‚úî";
            currentPicks.push(num);
            if(currentPicks.length >= limit) setTimeout(revealQuestions, 1000);
        }

        function revealQuestions() {
            let html = `<div class="stage-center"><div class="q-container">`;
            let thumbs = "";
            currentPicks.forEach(n => {
                const src = `${PHOTO_PATH}${n}.jpg`;
                const err = `https://via.placeholder.com/600x800?text=Question+${n}`;
                html += `<div class="royal-frame"><img src="${src}" onerror="this.src='${err}'"></div>`;
                thumbs += `<img src="${src}" class="q-thumb" onerror="this.src='${err}'">`;
            });
            html += `</div></div>`;
            if(stuWin) stuWin.document.body.innerHTML = html;
            if(audWin) audWin.document.body.innerHTML = html;
            document.getElementById('liveQuestions').innerHTML = thumbs;
            document.getElementById('judgeQView').innerHTML = thumbs;
            syncStyles();
        }

        // Actions
        function sendToScreen(mode) {
            if(!activeStudent || !audWin) return;
            if(mode === 'PROFILE') {
                audWin.document.body.innerHTML = `<div class="profile"><img src="${activeStudent.img}" style="width:200px; height:200px; border-radius:50%; border:3px solid #FFD700; object-fit:cover;"><h1>${activeStudent.name}</h1><h2 style="color:#FFD700;">${activeStudent.reg} | ${activeStudent.cat}</h2></div>`;
            } else if (mode === 'SCORE') {
                audWin.document.body.innerHTML = `<div class="profile"><h1>${activeStudent.name}</h1><h2 style="color:#aaa;">TOTAL SCORE</h2><div style="font-size:120px; color:#00e676; font-weight:bold;">95.0</div></div>`;
            }
            syncStyles();
        }

        function resetSystem() {
            if(currentPicks.length > 0) {
                usedNumbers = [...usedNumbers, ...currentPicks];
                localStorage.setItem('zaad_used', JSON.stringify(usedNumbers));
            }
            const standby = `<div class="welcome-card"><img src="https://academyzaad.com/photos/logo.png"><h1>NEXT STUDENT</h1><p style="font-size:20px; color:#FFD700;">Please Wait...</p></div>`;
            if(stuWin) stuWin.document.body.innerHTML = standby;
            if(audWin) audWin.document.body.innerHTML = standby;
            document.getElementById('liveQuestions').innerHTML = "";
            currentPicks = [];
            showToast("‚úÖ Ready");
            syncStyles();
        }

        function fullReset() { if(confirm("Clear history?")) { localStorage.removeItem('zaad_used'); usedNumbers=[]; showToast("Reset Done"); } }
        function submitScore() { showToast("‚úÖ Saved"); }
    </script>
</body>
</html>
